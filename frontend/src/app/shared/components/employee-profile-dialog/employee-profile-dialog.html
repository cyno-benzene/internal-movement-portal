<div class="employee-profile-sidebar">
  <!-- Header -->
  <div class="sidebar-header">
    <div class="header-content">
      <div class="employee-basic-info">
        <h2 class="employee-name">{{ data.employeeName }}</h2>
        <p class="employee-email">{{ data.employeeEmail }}</p>
        <div class="match-score" *ngIf="data.matchScore">
          <span class="score-label">Match Score</span>
          <span class="score-value" [ngClass]="getScoreClass(data.matchScore)">{{ data.matchScore | number:'1.0-1' }}%</span>
        </div>
      </div>
      <button mat-icon-button (click)="close()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Content -->
  <div class="sidebar-content">
    <div *ngIf="loading" class="loading-container">
      <mat-spinner diameter="32"></mat-spinner>
      <p>Loading profile...</p>
    </div>

    <div *ngIf="error" class="error-container">
      <mat-icon color="warn">error</mat-icon>
      <p>{{ error }}</p>
    </div>

    <div *ngIf="!loading && !error && profile" class="profile-sections">
      
      <!-- Match Analysis Section (if available) -->
      <div class="section match-analysis" *ngIf="data.explanation">
        <div class="section-header">
          <mat-icon>psychology</mat-icon>
          <h3>Match Analysis</h3>
        </div>
        <div class="section-content">
          <div class="match-reasons" *ngIf="data.explanation.reasons?.length">
            <h4>Key Matching Factors</h4>
            <ul class="reasons-list">
              <li *ngFor="let reason of data.explanation.reasons">{{ reason }}</li>
            </ul>
          </div>
          
          <div class="skill-matches" *ngIf="data.explanation.skill_matches?.length">
            <h4>Skill Match Details</h4>
            <div class="skill-scores">
              <div *ngFor="let skillMatch of data.explanation.skill_matches" class="skill-score-item">
                <span class="skill-name">{{ skillMatch.skill }}</span>
                <span class="skill-percentage">{{ (skillMatch.score * 100) | number:'1.0-1' }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Basic Information -->
      <div class="section basic-info">
        <div class="section-header">
          <mat-icon>person</mat-icon>
          <h3>Basic Information</h3>
        </div>
        <div class="section-content">
          <div class="info-grid">
            <div class="info-item">
              <span class="label">Current Role</span>
              <span class="value">{{ profile.current_job_title || 'Not specified' }}</span>
            </div>
            <div class="info-item">
              <span class="label">Total Experience</span>
              <span class="value">{{ formatTotalExperience(profile.months_experience || 0) }}</span>
            </div>
            <div class="info-item" *ngIf="profile.date_of_joining">
              <span class="label">Date of Joining</span>
              <span class="value">{{ profile.date_of_joining | date }}</span>
            </div>
            <div class="info-item" *ngIf="profile.months">
              <span class="label">Company Tenure</span>
              <span class="value">{{ formatTotalExperience(profile.months || 0) }}</span>
            </div>
            <div class="info-item" *ngIf="profile.rep_officer_name">
              <span class="label">Reporting Officer</span>
              <span class="value">{{ profile.rep_officer_name }}</span>
            </div>
            <div class="info-item" *ngIf="profile.location">
              <span class="label">Location</span>
              <span class="value">{{ profile.location }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Technical Skills -->
      <div class="section skills" *ngIf="profile.technical_skills?.length">
        <div class="section-header">
          <mat-icon>code</mat-icon>
          <h3>Technical Skills</h3>
        </div>
        <div class="section-content">
          <div class="skills-container">
            <div class="matching-skills" *ngIf="data.skillsMatch?.length">
              <h4>ðŸŽ¯ Skills Matching This Position</h4>
              <div class="skills-chips matching">
                <span *ngFor="let skill of data.skillsMatch" class="skill-chip match">
                  <mat-icon>check_circle</mat-icon>
                  {{ skill }}
                </span>
              </div>
            </div>
            
            <div class="other-skills" *ngIf="getOtherSkills().length">
              <div class="skills-chips">
                <span *ngFor="let skill of getOtherSkills()" class="skill-chip">
                  {{ skill }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Work Experience -->
      <div class="section work-experience" *ngIf="profile.work_experiences?.length">
        <div class="section-header">
          <mat-icon>work</mat-icon>
          <h3>Work Experience</h3>
        </div>
        <div class="section-content">
          <div class="experience-list">
            <div *ngFor="let exp of profile.work_experiences" class="experience-item">
              <div class="experience-header">
                <div class="title-and-type">
                  <h4 class="job-title">{{ exp.job_title }}</h4>
                  <span class="employment-type" [ngClass]="'type-' + (exp.employment_type || 'fulltime').toLowerCase().replace('-', '')">
                    {{ getEmploymentTypeLabel(exp.employment_type || 'fulltime') }}
                  </span>
                </div>
                <div class="company-name">{{ exp.company_name }}</div>
                <div class="experience-meta">
                  <span class="duration">{{ formatWorkExperienceDuration(exp) }}</span>
                  <span *ngIf="exp.location" class="location"> â€¢ {{ exp.location }}</span>
                </div>
              </div>
              <div *ngIf="exp.description" class="experience-description">
                {{ exp.description }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Legacy Experience (Past Companies) -->
      <div class="section past-companies" *ngIf="profile.past_companies?.length && !profile.work_experiences?.length">
        <div class="section-header">
          <mat-icon>business</mat-icon>
          <h3>Past Companies</h3>
        </div>
        <div class="section-content">
          <div class="companies-list">
            <div *ngFor="let company of profile.past_companies" class="company-item">
              <strong>{{ typeof company === 'string' ? company : company.name || company.company }}</strong>
              <span *ngIf="typeof company === 'object' && company.role" class="role">
                {{ company.role }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Certifications -->
      <div class="section certifications" *ngIf="profile.certifications?.length">
        <div class="section-header">
          <mat-icon>verified</mat-icon>
          <h3>Certifications</h3>
        </div>
        <div class="section-content">
          <div class="certifications-list">
            <span *ngFor="let cert of profile.certifications" class="certification-chip">
              {{ cert }}
            </span>
          </div>
        </div>
      </div>

      <!-- Education -->
      <div class="section education" *ngIf="profile.education?.length">
        <div class="section-header">
          <mat-icon>school</mat-icon>
          <h3>Education</h3>
        </div>
        <div class="section-content">
          <div class="education-list">
            <div *ngFor="let edu of profile.education" class="education-item">
              <div *ngIf="typeof edu === 'object'">
                <strong>{{ edu.institution || edu.degree }}</strong>
                <div *ngIf="edu.degree && edu.institution">{{ edu.degree }}</div>
                <div *ngIf="edu.field_of_study" class="field">{{ edu.field_of_study }}</div>
                <div *ngIf="edu.graduation_year" class="year">{{ edu.graduation_year }}</div>
              </div>
              <div *ngIf="typeof edu === 'string'">{{ edu }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Achievements -->
      <div class="section achievements" *ngIf="profile.achievements?.length">
        <div class="section-header">
          <mat-icon>emoji_events</mat-icon>
          <h3>Achievements</h3>
        </div>
        <div class="section-content">
          <ul class="achievements-list">
            <li *ngFor="let achievement of profile.achievements">{{ achievement }}</li>
          </ul>
        </div>
      </div>

      <!-- Career Aspirations -->
      <div class="section aspirations" *ngIf="profile.career_aspirations">
        <div class="section-header">
          <mat-icon>trending_up</mat-icon>
          <h3>Career Aspirations</h3>
        </div>
        <div class="section-content">
          <div class="aspirations-text">
            {{ profile.career_aspirations }}
          </div>
        </div>
      </div>

      <!-- Publications -->
      <div class="section publications" *ngIf="profile.publications?.length">
        <div class="section-header">
          <mat-icon>article</mat-icon>
          <h3>Publications</h3>
        </div>
        <div class="section-content">
          <ul class="publications-list">
            <li *ngFor="let publication of profile.publications">{{ publication }}</li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</div>
